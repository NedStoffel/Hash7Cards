# Hash7Cards

Fast hash for 64-bit integers representing 7-card poker hand. This representation of a poker hand has seven bits set to indicate which 7 cards are in the hand. For example, the lowest order bit could represent the 2 of clubs, and the next bit would represent the 3 of clubs, etc. 

The hash algorithm works by slicing the 64-bit integer into three slices and then using switch statements to resolve this to a unique number. The switch logic is generated by an internal function of the Mhash class which is triggered by the option -g.

The option -tN invokes the Mhash::testHash() method N times. The testHash() method uses a tight nested loop to create representations of all possible 7-card hands from an ordinary 52-card deck. Each of these hands is hashed to a value, h7, and hashCnt[h7] is incremented.

SANITY TEST: There are 133,784,560 unique 7-card hands. hashCnt[h7] counts the number of times a hand hashes to each value. This should be exactly equal to the number of times the timing loop iterates through all possible hands. If this is not true, the sanity test prints out exceptions to this rule. There should be no exceptions printed out during this test.

Explanation of the Switch Statement created by the Mhash::generate() method

The output of generate is saved to the switch.cpp file. Then, this file is included in this class to do the actual hashing.

The switch statement in switch.cpp is used to calculate a unique hash value (rHash) for a 7-card hand based on the pattern of bits set in the 64-bit integer b7. Here's a detailed breakdown:

Switch on kind

The variable kind is determined by the number of bits set in different parts of b7. It effectively categorizes the bit patterns into cases.

Case Structure

Each case represents a unique combination of bits set in three slices of b7 (lower 18 bits, middle 18 bits, and upper bits). For example, case 0 represents a pattern where the upper bits have 7 bits set, and both the middle and lower bits have none.

Bit Projection and Index Calculation

For each case, the bits are projected out of b7 and assigned to variables p0, p1, and p2 using bitwise operations. These projections isolate specific slices of bits.

The corresponding indices (ind18_7, ind16_7_x) are then used to calculate the final hash value rHash. These indices map the bit patterns to unique values.

Total Count and Offset

The totCnt (total count) for each case is calculated based on the number of combinations possible for the given bit pattern. This ensures that each hash value is unique.

An offset is added to rHash to account for the cumulative count of previous cases, ensuring uniqueness across all cases.

The hash function is only defined across the set of integers with exactly seven of the lower 52 bits set and none of the 53rd to 64th bits set.
